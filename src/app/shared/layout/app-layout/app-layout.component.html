<div class="min-h-screen xl:flex">
  <!-- Top Progress Bar (Navigation) -->
  @if (isNavigating()) {
  <p-progressBar mode="indeterminate"
    [style]="{ height: '3px', position: 'fixed', top: '0', left: '0', 'z-index': '999999', width: '100%' }" />
  }

  <!-- Global HTTP Loader (Blocking) -->
  @if (isLoading()) {
  <p-blockUI [blocked]="true">
    <div class="fixed inset-0 flex flex-col items-center justify-center z-[999991]">
      <p-progressSpinner styleClass="w-16 h-16" strokeWidth="4" fill="transparent" animationDuration=".5s" />
    </div>
  </p-blockUI>
  }
  <div>
    <app-sidebar></app-sidebar>
    <app-backdrop></app-backdrop>
  </div>
  <div class="flex-1 transition-all duration-300 ease-in-out" [ngClass]="{
        'xl:ml-(--sidebar-width)': isExpanded() || isHovered(),
        'xl:ml-(--sidebar-collapsed-width)': !isExpanded() && !isHovered(),
        'ml-0': isMobileOpen()
      }">
    <!-- app header start -->
    <app-header />
    <!-- app header end -->
    <div class="p-(--main-padding) mx-auto max-w-(--breakpoint-3xl)">
      @if (isNavigating()) {
      <app-ui-skeleton-page class="block animate-in fade-in duration-300" />
      }

      <div [class.hidden]="isNavigating()">
        <router-outlet></router-outlet>
      </div>

      <!-- Network Resilience Dialog -->
      <p-dialog header="Conexión Interrumpida" [visible]="showConnectionError()" [modal]="true" [closable]="false"
        [closeOnEscape]="false" [style]="{ width: '25rem' }">
        <div class="flex flex-col items-center gap-4 text-center">
          <i class="pi pi-wifi text-6xl text-gray-400"></i>
          <p class="m-0 text-gray-600 dark:text-gray-300">
            No pudimos cargar recursos necesarios de la aplicación.
            Posiblemente perdiste la conexión a Internet o el servidor se actualizó.
          </p>
        </div>
        <ng-template pTemplate="footer">
          <p-button label="Recargar Página" icon="pi pi-refresh" (onClick)="reloadPage()" severity="primary"
            class="w-full" styleClass="w-full" />
        </ng-template>
      </p-dialog>
    </div>
  </div>
</div>